<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NKids â€” Prototype</title>
  <style>
    /* Minimal CSS : responsive, simple look */
    body{font-family:Inter,system-ui,Arial;margin:0;background:#0f1724;color:#e6eef8;display:flex;min-height:100vh;align-items:stretch}
    #sidebar{width:320px;background:#0b1220;padding:18px;box-shadow:2px 0 20px rgba(0,0,0,.4)}
    #main{flex:1;padding:18px}
    button{cursor:pointer;padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white}
    .card{background:#071026;padding:12px;border-radius:10px;margin-bottom:12px}
    input,select{padding:8px;border-radius:8px;border:1px solid #223045;background:#071026;color:#e6eef8;width:100%}
    .msg{padding:8px;border-radius:8px;margin-bottom:6px;background:#07203a}
    .meta{font-size:12px;opacity:.7}
    .small{font-size:13px;color:#9fb3d6}
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>NKids ðŸ‘¶ â€” Prototype</h2>
    <div id="userArea" class="card">
      <div id="signedOut">
        <p class="small">Connecte-toi avec pseudo et mot de passe</p>
        <input id="username" placeholder="Pseudo" />
        <input type="password" id="password" placeholder="Mot de passe" />
        <button id="loginBtn">Se connecter / crÃ©er compte</button>
        <p id="loginMsg" class="small"></p>
      </div>
      <div id="signedIn" style="display:none">
        <p id="userName"></p>
        <button id="signOutBtn">Se dÃ©connecter</button>
      </div>
    </div>

    <div class="card">
      <h3>Nitro gratuit</h3>
      <p class="small">Badge NKids Nitro activÃ© âœ…</p>
      <button id="enableNitro">Activer Nitro (gratuit)</button>
    </div>
  </div>

  <div id="main">
    <div class="card">
      <h3>Salon: #general</h3>
      <div id="messages" style="height:320px;overflow:auto;background:#041328;padding:10px;border-radius:8px;margin-bottom:8px"></div>
      <div style="display:flex;gap:8px">
        <input id="messageInput" placeholder="Ã‰crire un message..." />
        <button id="sendBtn">Envoyer</button>
      </div>
    </div>
  </div>

  <script>
    // --- Stockage local
    let users = JSON.parse(localStorage.getItem('nkidsUsers') || '{}');
    let currentUser = null;
    let messages = JSON.parse(localStorage.getItem('nkidsMessages') || '[]');

    // --- UI refs
    const signedOut = document.getElementById('signedOut');
    const signedIn = document.getElementById('signedIn');
    const userNameEl = document.getElementById('userName');
    const loginMsg = document.getElementById('loginMsg');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const messagesEl = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');

    // --- Connexion / crÃ©ation compte
    document.getElementById('loginBtn').onclick = ()=>{
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();
      if(!username || !password){ loginMsg.textContent='Remplis les deux champs !'; return; }

      if(users[username]){
        if(users[username] !== password){ loginMsg.textContent='Mot de passe incorrect !'; return; }
      } else {
        users[username] = password;
        localStorage.setItem('nkidsUsers', JSON.stringify(users));
      }
      currentUser = username;
      signedOut.style.display='none';
      signedIn.style.display='block';
      userNameEl.textContent=currentUser;
      loginMsg.textContent='';
      renderMessages();
    };

    // --- DÃ©connexion
    document.getElementById('signOutBtn').onclick = ()=>{
      currentUser=null;
      signedOut.style.display='block';
      signedIn.style.display='none';
    };

    // --- Nitro
    document.getElementById('enableNitro').onclick = ()=>{
      if(!currentUser){ alert('Connecte-toi'); return; }
      alert('Nitro NKids activÃ© âœ… (local)');
    };

    // --- Envoyer message
    document.getElementById('sendBtn').onclick = ()=>{
      const text = messageInput.value.trim();
      if(!text || !currentUser) return;
      const msg={name:currentUser,text,ts:Date.now()};
      messages.push(msg);
      localStorage.setItem('nkidsMessages', JSON.stringify(messages));
      messageInput.value='';
      renderMessages();
    };

    // --- Affichage messages
    function renderMessages(){
      messagesEl.innerHTML='';
      messages.forEach(m=>{
        const el = document.createElement('div');
        el.className='msg';
        el.innerHTML = `<strong>${escapeHtml(m.name)}</strong> <div class="meta">${new Date(m.ts).toLocaleTimeString()}</div><div>${escapeHtml(m.text)}</div>`;
        messagesEl.appendChild(el);
      });
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // --- Helper
    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // --- Charger messages au dÃ©part
    renderMessages();
  </script>
</body>
</html>
